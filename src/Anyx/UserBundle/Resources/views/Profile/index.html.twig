{% extends '::main.html.twig' %}

{% block javascripts %}
	{{ parent() }}

	{% javascripts
		'@AnyxCrosswordBundle/Resources/public/js/jquery.min.js'
		'@AnyxCrosswordBundle/Resources/public/js/jquery-ui.min.js'

        '@FOSJsRoutingBundle/Resources/public/js/router.js'
	
		'@AnyxCrosswordBundle/Resources/public/js/json2.js'
		'@AnyxCrosswordBundle/Resources/public/js/underscore.js'
		'@AnyxCrosswordBundle/Resources/public/js/backbone.js'
        '@AnyxCrosswordBundle/Resources/public/js/bootstrap-modal.js'
		
		'@AnyxCrosswordBundle/Resources/public/js/views/View.js'

		'@AnyxCrosswordBundle/Resources/public/js/models/Crossword.js'

        '@AnyxUserBundle/Resources/public/js/models/Collection.js'

		'@AnyxUserBundle/Resources/public/js/models/Crossword.js'
		'@AnyxUserBundle/Resources/public/js/models/CrosswordCollection.js'

		'@AnyxUserBundle/Resources/public/js/models/Solution.js'
		'@AnyxUserBundle/Resources/public/js/models/SolutionCollection.js'

		'@AnyxUserBundle/Resources/public/js/ProfileWorkspace.js'

		'@AnyxUserBundle/Resources/public/js/views/ProfileMenu.js'
        '@AnyxUserBundle/Resources/public/js/views/ErrorView.js'
		'@AnyxUserBundle/Resources/public/js/views/CollectionView.js'
		'@AnyxUserBundle/Resources/public/js/views/SolutionsView.js'
		'@AnyxUserBundle/Resources/public/js/views/CrosswordsView.js'
	%}
	<script type="text/javascript" src="{{ asset_url }}"></script>
	{% endjavascripts %}

    <script type="text/javascript" src="{{ path('fos_js_routing_js', {"callback" : "fos.Router.setData"}) }}"></script>
    
	<script type="text/javascript">
		$(function() {
			
			var workspace = new Anyx.Profile.Workspace({
				document	: window.document,
                menuView    : new Anyx.View.ProfileMenu({
                    el			: $('#i-profile-menu'),
                    template	: 't-profile-menu'
                }),
                errorView   : new Anyx.View.Error({
                    template    : 't-error-block'
                }),
				views		: {
					solved	: new Anyx.View.Solutions({
						el			: $('#i-solutions'),
						template	: 't-solutions',
					}),
                    created : new Anyx.View.Crosswords({
						el			: $('#i-crosswords'),
						template	: 't-crosswords',
                        selectors   : {
                            modalWindow     : '.removingModal',
                            crosswordName   : '.i-crossword-name',
                            removeButton    : '.i-remove-button',
                            closeButton     : '.i-close-button'
                        },
                        router      : Routing,
                        deleteRoute : 'remove_crossword'
                    }),
				},
                messages    : {
                    internalError : '{%trans%}Internal Server Error{%endtrans%}'
                }
			});

			Backbone.history.start();
		});
	</script>			
{% endblock %}	

{% block page_title %}
	{%trans%}User profile{%endtrans%}
{% endblock %}
	
{% block body %}

    <div id="i-profile-menu">
	</div>
	
	<div id="i-profile-page">
		<div id="i-solutions"></div>
        <div id="i-crosswords">
        </div>
	</div>
	
	<script type="text/template" id="t-profile-menu">
		<ul class="nav nav-tabs">
			<% _.each(links, function( name ) { %>
			<li rel="<%=name%>" <% if ( activeLink && activeLink == name) { %> class="active" <% }%>>
                <a href="#/<%=name%>/"><%=name%></a>
            </li>
			<% }); %>
		</ul>	
	</script>

	<script type="text/template" id="t-solutions">
		<table class="table table-striped">
		<thead>
			<th>{%trans%}Crossword{%endtrans%}</th>
			<th>{%trans%}Solution date{%endtrans%}</th>
			<th>{%trans%}Correct{%endtrans%}</th>
		</thead>
		<tfoot>
			<tr>
				<td colspan="3">
                    <% if( !collection.isAll() ) { %>
					<div class="">
						<a class="i-more-link" href="#">{%trans%}More{%endtrans%}</a>
					</div>
                    <% } %>
				</td>
			</tr>
		</tfoot>
		<tbody>
		<% if ( !_.isEmpty( collection.models ) ) { %>
			<% _.each(collection.models, function( solution ) { %>
			<tr>
				<td>
					<a href="#"><%=solution.get('crossword').title%></a>
					<p>
						<%=solution.get('crossword').description%>
					</p>
				</td>
				<td><%=solution.get('updated_at')%></td>
				<td><%=solution.get('is_correct')%></td>
			</tr>
			<% }); %>
		<% } else { %>
			<tr>
				<td colspan="3">
					{%trans%}Solutions not found{%endtrans%}
					<a href="#">{%trans%}Want now?{%endtrans%}</a>
				</td>
			</tr>
		<% } %>
		</tbody>
		</table>	
	</script>
	
    <script type="text/template" id="t-crosswords">
        <a href="{{ path('create_crossword')}}" class="">{%trans%}Create{%endtrans%}</a>
        
		<table class="table table-striped">
		<thead>
			<th>{%trans%}Crossword{%endtrans%}</th>
			<th>{%trans%}Date create{%endtrans%}</th>
			<th class="th-center">{%trans%}Public{%endtrans%}</th>
			<th class="th-center">{%trans%}Count solves{%endtrans%}</th>
            <th class="th-center">{%trans%}Manage{%endtrans%}</th>
		</thead>
		<tfoot>
			<tr>
				<td colspan="5">
                    <% if( !collection.isAll() ) { %>
					<div class="">
						<a class="i-more-link" href="#">{%trans%}More{%endtrans%}</a>
					</div>
                    <% } %>
				</td>
			</tr>
		</tfoot>
        <tbody>
		<% if ( !_.isEmpty( collection.models ) ) { %>
			<% _.each(collection.models, function( crossword ) { %>
			<tr>
				<td>
					<a href="<%=Routing.generate('crossword_solve', { id: crossword.get('id') })%>"><%=crossword.get('title')%></a>
					<p>
						<%=crossword.get('description')%>
					</p>
				</td>
				<td><%=crossword.get('updated_at')%></td>
				<td class="td-center">
                    <% if( crossword.get('public') ) { %>
                    <span class="icon-ok" title="{%trans%}Public{%endtrans%}"></span>
                    <% } else { %>
                    <span class="icon-wrench" title="{%trans%}Under construction{%endtrans%}"></span>
                    <% } %>
                </td>
                <td class="td-center"><%=crossword.get('count_solving')%></td>
                <td class="td-center">
                    <a href="<%=Routing.generate('crossword_statistic', { id: crossword.get('id') })%>" title="{%trans%}View statistic{%endtrans%}">
                        <span class="icon-list-alt"></span>
                    </a>
                    <a href="<%=Routing.generate('edit_crossword', { id: crossword.get('id') })%>" title="{%trans%}Edit{%endtrans%}">
                        <span class="icon-edit"></span>
                    </a>
                        <a class="i-remove-crossword" href="#" data-id="<%=crossword.get('id')%>" title="{%trans%}Remove{%endtrans%}">
                        <span class="icon-remove"></span>
                    </a>
                </td>
			</tr>
			<% }); %>
		<% } else { %>
			<tr>
				<td colspan="5">
					{%trans%}Crosswords not found{%endtrans%}
					<a href="{{ path('create_crossword')}}">{%trans%}Want create now?{%endtrans%}</a>
				</td>
			</tr>
		<% } %>            
        </tbody>
        </table>
        
        <div class="modal hide fade removingModal">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">×</button>
                <h3>{% trans %}Crossword removing{%endtrans%}</h3>
            </div>
            <div class="modal-body">
                {% trans %}Are you sure want remove crossword{%endtrans%} <em>&laquo;</em><em class="i-crossword-name">Crossword name</em><em>&raquo;</em>?
            </div>
            <div class="modal-footer">
                <a href="#" class="btn i-close-button">{%trans%}Close{%endtrans%}</a>
                <a href="#" class="btn btn-primary i-remove-button">{%trans%}Remove{%endtrans%}</a>
            </div>
        </div>
    </script>
	
    <script type="text/template" id="t-error-block">
        <div class="alert alert-error profile-error modal fade">
            <button type="button" class="close i-close-button" data-dismiss="alert">×</button>
            <strong>{% trans %}Error{%endtrans%}</strong>
            <div>
            <%=message%>
            </div>
        </div>
    </script>
{% endblock body %}